import numpy as np
from scipy.fft import rfft, rfftfreq
import time

# Constants
SAMPLING_FREQUENCY = 192000  # in Hz
BUFFER_SIZE = 4096  # Size of PCM_Buffer
DETECTION_FREQUENCY = 1000  # Frequency to detect (in Hz)
FREQUENCY_TOLERANCE = 50  # Tolerance for frequency detection (in Hz)
#Bin Size is 47.619 so 50 should work (or a little less--maybe exactly 47.619)
TIMEOUT_SECONDS = 5  # Timeout in seconds

# Define your PCM buffer here
# Replace this with your actual PCM buffer data
PCM_Buffer = [-3444, -3459, -3471, -3466, -3444, -3419, -3392, -3377, -3371, -3375, -3373, -3353, -3329, -3316, -3300, -3265, -3233, -3220, -3215, -3199, -3179, -3153, -3133, -3121, -3109, -3081, -3032, -2973, -2925, -2886, -2856, -2856, -2869, -2863, -2822, -2753, -2683, -2621, -2569, -2520, -2488, -2461, -2427, -2396, -2374, -2335, -2261, -2167, -2068, -1984, -1927, -1893, -1874, -1851, -1808, -1741, -1672, -1593, -1518, -1456, -1400, -1336, -1273, -1223, -1189, -1147, -1101, -1043, -969, -882, -794, -730, -694, -667, -637, -604, -551, -472, -377, -297, -240, -210, -204, -198, -151, -66, 42, 141, 203, 229, 240, 256, 300, 387, 485, 569, 630, 664, 684, 720, 779, 850, 923, 986, 1039, 1084, 1122, 1168, 1219, 1268, 1328, 1396, 1480, 1554, 1609, 1652, 1693, 1728, 1770, 1832, 1909, 1985, 2045, 2091, 2127, 2167, 2209, 2265, 2333, 2406, 2466, 2505, 2528, 2547, 2579, 2633, 2700, 2774, 2833, 2870, 2883, 2895, 2914, 2948, 2993, 3040, 3078, 3105, 3112, 3125, 3154, 3195, 3226, 3244, 3245, 3231, 3224, 3233, 3257, 3295, 3327, 3342, 3342, 3325, 3303, 3300, 3302, 3310, 3316, 3317, 3312, 3300, 3285, 3278, 3292, 3306, 3309, 3299, 3288, 3276, 3255, 3241, 3238, 3225, 3211, 3205, 3199, 3193, 3182, 3156, 3125, 3096, 3072, 3070, 3072, 3054, 3023, 2993, 2971, 2958, 2949, 2931, 2890, 2833, 2776, 2730, 2706, 2705, 2704, 2693, 2655, 2590, 2515, 2452, 2409, 2377, 2354, 2327, 2287, 2235, 2177, 2101, 2020, 1967, 1932, 1909, 1882, 1824, 1741, 1650, 1588, 1550, 1520, 1480, 1417, 1344, 1268, 1207, 1160, 1123, 1100, 1073, 1026, 961, 885, 823, 776, 744, 711, 668, 623, 570, 510, 450, 400, 345, 291, 246, 205, 172, 129, 67, -4, -80, -154, -210, -249, -287, -332, -379, -447, -535, -619, -681, -730, -780, -832, -883, -942, -1010, -1086, -1155, -1216, -1269, -1314, -1353, -1403, -1462, -1532, -1609, -1683, -1750, -1793, -1823, -1861, -1913, -1980, -2043, -2099, -2156, -2220, -2277, -2333, -2383, -2428, -2467, -2522, -2581, -2631, -2676, -2717, -2754, -2794, -2835, -2876, -2930, -2983, -3014, -3028, -3032, -3030, -3045, -3085, -3148, -3204, -3249, -3270, -3268, -3265, -3271, -3273, -3274, -3279, -3293, -3313, -3341, -3372, -3391, -3391, -3378, -3362, -3367, -3384, -3405, -3408, -3388, -3361, -3348, -3355, -3365, -3372, -3378, -3387, -3379, -3356, -3327, -3302, -3283, -3273, -3276, -3291, -3295, -3280, -3246, -3214, -3183, -3147, -3118, -3100, -3092, -3092, -3089, -3064, -3020, -2969, -2931, -2902, -2878, -2866, -2860, -2851, -2813, -2744, -2674, -2617, -2573, -2545, -2539, -2540, -2530, -2485, -2402, -2299, -2199, -2130, -2102, -2089, -2068, -2029, -1966, -1891, -1808, -1735, -1680, -1645, -1618, -1577, -1509, -1431, -1341, -1260, -1214, -1196, -1177, -1143, -1078, -988, -895, -824, -767, -722, -683, -650, -632, -604, -546, -465, -375, -285, -220, -182, -161, -150, -125, -70, 12, 105, 200, 267, 302, 328, 363, 406, 460, 528, 607, 674, 736, 790, 840, 889, 936, 978, 1027, 1083, 1154, 1221, 1282, 1336, 1389, 1457, 1522, 1570, 1616, 1665, 1720, 1782, 1844, 1914, 1982, 2027, 2067, 2107, 2152, 2210, 2268, 2319, 2365, 2413, 2463, 2519, 2567, 2614, 2658, 2699, 2749, 2796, 2835, 2863, 2879, 2903, 2939, 2976, 3018, 3057, 3086, 3106, 3126, 3151, 3169, 3187, 3205, 3210, 3215, 3228, 3247, 3268, 3294, 3319, 3323, 3307, 3294, 3293, 3300, 3301, 3309, 3321, 3333, 3336, 3331, 3316, 3296, 3283, 3289, 3294, 3297, 3299, 3284, 3259, 3236, 3228, 3235, 3246, 3253, 3244, 3210, 3171, 3136, 3114, 3111, 3113, 3114, 3103, 3069, 3023, 2981, 2957, 2952, 2947, 2935, 2909, 2871, 2827, 2794, 2779, 2760, 2733, 2704, 2670, 2621, 2560, 2509, 2475, 2443, 2407, 2369, 2321, 2262, 2196, 2141, 2091, 2053, 2016, 1972, 1922, 1860, 1779, 1698, 1635, 1586, 1553, 1534, 1514, 1452, 1366, 1288, 1229, 1183, 1149, 1103, 1036, 967, 910, 875, 846, 819, 778, 711, 628, 562, 516, 483, 457, 418, 359, 289, 232, 189, 151, 103, 32, -47, -114, -162, -199, -230, -257, -312, -392, -479, -560, -630, -680, -720, -756, -796, -855, -932, -1005, -1079, -1146, -1194, -1226, -1269, -1324, -1397, -1478, -1551, -1603, -1649, -1693, -1739, -1801, -1875, -1966, -2043, -2099, -2125, -2151, -2192, -2256, -2326, -2398, -2463, -2505, -2535, -2564, -2604, -2657, -2716, -2770, -2808, -2835, -2857, -2885, -2910, -2943, -2999, -3061, -3106, -3127, -3129, -3124, -3132, -3164, -3205, -3246, -3284, -3313, -3322, -3317, -3300, -3283, -3285, -3305, -3335, -3369, -3397, -3412, -3400, -3368, -3344, -3340, -3361, -3391, -3417, -3423, -3413, -3389, -3360, -3336, -3319, -3319, -3324, -3328, -3332, -3325, -3308, -3284, -3263, -3250, -3248, -3246, -3236, -3215, -3175, -3135, -3117, -3103, -3090, -3070, -3049, -3024, -2989, -2961, -2941, -2930, -2909, -2876, -2825, -2756, -2702, -2676, -2664, -2650, -2626, -2581, -2516, -2435, -2354, -2308, -2295, -2281, -2241, -2176, -2096, -2016, -1952, -1913, -1888, -1861, -1815, -1745, -1657, -1567, -1508, -1469, -1432, -1390, -1340, -1280, -1210, -1148, -1088, -1028, -973, -910, -855, -814, -777, -731, -678, -616, -544, -478, -410, -347, -298, -266, -235, -194, -135, -71, 0, 76, 136, 180, 216, 257, 311, 371, 428, 493, 557, 611, 660, 714, 767, 811, 858, 912, 973, 1034, 1093, 1154, 1213, 1265, 1319, 1376, 1435, 1490, 1542, 1602, 1659, 1722, 1792, 1864, 1921, 1958, 2002, 2045, 2089, 2147, 2217, 2286, 2351, 2412, 2458, 2492, 2523, 2557, 2606, 2661, 2716, 2759, 2790, 2821, 2847, 2874, 2907, 2958, 3012, 3039, 3048, 3063, 3086, 3113, 3148, 3185, 3211, 3227, 3227, 3219, 3211, 3219, 3245, 3265, 3276, 3282, 3292, 3305, 3322, 3337, 3334, 3319, 3310, 3298, 3284, 3289, 3297, 3306, 3310, 3309, 3305, 3292, 3281, 3269, 3257, 3244, 3238, 3239, 3229, 3213, 3195, 3181, 3172, 3166, 3162, 3148, 3119, 3090, 3063, 3039, 3024, 3010, 2993, 2972, 2944, 2908, 2878, 2855, 2822, 2788, 2774, 2756, 2718, 2673, 2634, 2601, 2559, 2512, 2471, 2440, 2412, 2375, 2329, 2270, 2203, 2139, 2082, 2043, 2013, 1976, 1927, 1873, 1804, 1727, 1661, 1609, 1567, 1529, 1482, 1407, 1326, 1254, 1207, 1180, 1160, 1133, 1084, 1012, 932, 864, 808, 761, 735, 711, 673, 612, 541, 475, 427, 388, 349, 310, 262, 205, 146, 87, 22, -41, -96, -127, -150, -203, -274, -345, -410, -480, -534, -579, -634, -697, -759, -824, -877, -923, -974, -1045, -1124, -1207, -1283, -1341, -1390, -1424, -1448, -1486, -1553, -1638, -1737, -1825, -1879, -1902, -1917, -1946, -2000, -2073, -2146, -2216, -2289, -2336, -2360, -2391, -2432, -2474, -2519, -2581, -2644, -2705, -2759, -2795, -2825, -2854, -2883, -2917, -2943, -2974, -3016, -3070, -3117, -3142, -3164, -3189, -3203, -3205, -3212, -3237, -3282, -3322, -3350, -3358, -3350, -3337, -3329, -3333, -3352, -3382, -3403, -3401, -3390, -3374, -3368, -3377, -3394, -3409, -3407, -3386, -3372, -3366, -3368, -3370, -3360, -3351, -3340, -3322, -3296, -3280, -3269, -3272, -3276, -3269, -3243, -3212, -3188, -3172, -3164, -3150, -3131, -3115, -3099, -3071, -3035, -3010, -2986, -2957, -2911, -2866, -2834, -2814, -2793, -2766, -2732, -2701, -2670, -2616, -2546, -2474, -2423, -2390, -2360, -2340, -2320, -2276, -2203, -2102, -2004, -1946, -1916, -1898, -1873, -1823, -1744, -1665, -1596, -1531, -1476, -1429, -1402, -1371, -1317, -1239, -1147, -1053, -971, -927, -920, -909, -880, -816, -718, -617, -541, -497, -473, -453, -418, -354, -272, -192, -128, -82, -36, 0, 40, 91, 155, 218, 265, 308, 361, 426, 493, 560, 628, 677, 707, 734, 779, 844, 921, 998, 1062, 1109, 1148, 1195, 1248, 1312, 1376, 1438, 1501, 1565, 1627, 1680, 1729, 1782, 1842, 1904, 1973, 2035, 2078, 2114, 2158, 2221, 2297, 2362, 2416, 2467, 2506, 2541, 2570, 2604, 2652, 2702, 2752, 2808, 2852, 2872, 2889, 2909, 2941, 2980, 3018, 3062, 3097, 3115, 3124, 3122, 3132, 3160, 3188, 3215, 3240, 3251, 3251, 3251, 3250, 3268, 3282, 3289, 3290, 3297, 3313, 3319, 3318, 3308, 3305, 3309, 3305, 3306, 3315, 3326, 3327, 3314, 3288, 3266, 3257, 3264, 3277, 3277, 3258, 3235, 3215, 3196, 3181, 3171, 3164, 3142, 3116, 3094, 3082, 3073, 3057, 3033, 2995, 2977, 2964, 2954, 2934, 2908, 2871, 2833, 2794, 2758, 2726, 2701, 2678, 2655, 2619, 2568, 2513, 2461, 2433, 2407, 2375, 2322, 2259, 2201, 2145, 2094, 2045, 1999, 1945, 1885, 1832, 1783, 1740, 1693, 1628, 1554, 1489, 1440, 1388, 1336, 1287, 1242, 1197, 1158, 1110, 1044, 973, 917, 873, 835, 796, 756, 709, 649, 588, 530, 479, 439, 407, 367, 304, 231, 165, 106, 70, 45, 10, -40, -103, -181, -260, -326, -378, -420, -452, -489, -544, -607, -676, -750, -813, -872, -927, -984, -1043, -1106, -1166, -1212, -1258, -1307, -1364, -1441, -1524, -1596, -1646, -1688, -1720, -1757, -1811, -1885, -1975, -2055, -2106, -2144, -2178, -2230, -2286, -2345, -2411, -2461, -2491, -2523, -2558, -2597, -2654, -2728, -2797, -2845, -2869, -2875, -2877, -2892, -2927, -2988, -3047, -3095, -3127, -3151, -3165, -3180, -3203, -3216, -3217, -3236, -3273, -3321, -3342, -3338, -3328, -3321, -3328, -3335, -3353, -3369, -3375, -3388, -3403, -3408, -3400, -3389, -3373, -3360, -3356, -3359, -3374, -3394, -3394, -3370, -3344, -3329, -3317, -3302, -3288, -3281, -3288, -3293, -3276, -3237, -3196, -3171, -3172, -3178, -3167, -3144, -3116, -3079, -3040, -3013, -3000, -2986, -2969, -2933, -2885, -2839, -2800, -2770, -2750, -2734, -2706, -2666, -2620, -2565, -2498, -2441, -2397, -2359, -2313, -2278, -2243, -2195, -2128, -2049, -1980, -1938, -1902, -1853, -1803, -1751, -1690, -1624, -1563, -1503, -1452, -1405, -1349, -1285, -1217, -1148, -1094, -1058, -1020, -970, -909, -842, -776, -707, -645, -591, -555, -530, -491, -422, -338, -261, -192, -128, -83, -61, -26, 19, 71, 125, 189, 264, 341, 408, 463, 498, 529, 574, 642, 713, 778, 833, 881, 925, 971, 1028, 1093, 1162, 1224, 1284, 1333, 1377, 1424, 1478, 1549, 1630, 1709, 1774, 1833, 1884, 1930, 1968, 2015, 2070, 2123, 2185, 2247, 2303, 2362, 2425, 2482, 2528, 2569, 2598, 2625, 2667, 2707, 2745, 2781, 2816, 2856, 2893, 2923, 2955, 2993, 3032, 3066, 3083, 3098, 3111, 3122, 3142, 3175, 3212, 3240, 3251, 3247, 3251, 3255, 3264, 3274, 3281, 3296, 3309, 3319, 3327, 3329, 3329, 3326, 3332, 3340, 3342, 3330, 3314, 3298, 3294, 3296, 3294, 3289, 3293, 3289, 3276, 3258, 3236, 3210, 3188, 3176, 3172, 3176, 3180, 3168, 3136, 3101, 3064, 3045, 3047, 3056, 3052, 3025, 2976, 2923, 2886, 2860, 2846, 2842, 2824, 2785, 2740, 2700, 2668, 2641, 2614, 2582, 2539, 2487, 2427, 2375, 2333, 2302, 2269, 2229, 2173, 2099, 2027, 1973, 1935, 1893, 1852, 1797, 1719, 1648, 1598, 1560, 1518, 1462, 1391, 1334, 1286, 1232, 1176, 1127, 1086, 1045, 1001, 945, 886, 832, 792, 743, 690, 636, 599, 561, 517, 473, 427, 356, 278, 213, 171, 135, 109, 78, 17, -64, -161, -235, -281, -295, -311, -350, -404, -486, -590, -674, -727, -761, -789, -835, -898, -965, -1044, -1120, -1171, -1217, -1271, -1332, -1395, -1469, -1538, -1589, -1628, -1673, -1727, -1778, -1840, -1909, -1984, -2040, -2080, -2113, -2154, -2206, -2269, -2333, -2391, -2439, -2497, -2553, -2604, -2645, -2679, -2707, -2733, -2772, -2817, -2866, -2919, -2958, -2997, -3032, -3056, -3080, -3101, -3122, -3149, -3180, -3215, -3246, -3262, -3266, -3279, -3297, -3314, -3325, -3330, -3337, -3354, -3371, -3377, -3377, -3374, -3373, -3378, -3381, -3387, -3393, -3400, -3392, -3370, -3344, -3330, -3343, -3369, -3400, -3405, -3381, -3343, -3305, -3270, -3257, -3253, -3253, -3268, -3266, -3253, -3226, -3192, -3151, -3116, -3091, -3076, -3072, -3061, -3034, -2993, -2954, -2927, -2916, -2897, -2868, -2831, -2790, -2745, -2690, -2638, -2604, -2589, -2589, -2567, -2511, -2436, -2357, -2292, -2237, -2190, -2151, -2115, -2072, -2023, -1963, -1899, -1831, -1772, -1727, -1679, -1633, -1587, -1530, -1459, -1385, -1332, -1292, -1249, -1185, -1113, -1054, -1005, -953, -902, -858, -814, -757, -690, -618, -550, -491, -434, -384, -346, -317, -270, -198, -115, -40, 16, 44, 68, 101, 151, 228, 319, 407, 466, 502, 529, 551, 594, 660, 734, 815, 892, 951, 989, 1011, 1040, 1096, 1179, 1265, 1337, 1396, 1432, 1466, 1506, 1568, 1639, 1722, 1802, 1863, 1917, 1969, 2016, 2053, 2087, 2140, 2205, 2271, 2327, 2384, 2436, 2486, 2535, 2572, 2604, 2642, 2692, 2743, 2788, 2822, 2848, 2869, 2893, 2919, 2948, 2994, 3035, 3064, 3072, 3076, 3089, 3111, 3135, 3163, 3201, 3213, 3198, 3196, 3221, 3245, 3262, 3272, 3276, 3275, 3281, 3298, 3319, 3333, 3324, 3303, 3292, 3292, 3297, 3308, 3311, 3301, 3278, 3264, 3259, 3255, 3256, 3252, 3243, 3225, 3208, 3195, 3189, 3191, 3181, 3152, 3121, 3090, 3065, 3053, 3049, 3041, 3032, 3006, 2968, 2925, 2898, 2891, 2877, 2865, 2850, 2817, 2756, 2694, 2657, 2632, 2601, 2578, 2554, 2520, 2466, 2409, 2356, 2304, 2258, 2222, 2187, 2145, 2098, 2051, 1997, 1934, 1863, 1796, 1740, 1697, 1663, 1634, 1596, 1543, 1471, 1372, 1275, 1221, 1205, 1194, 1162, 1104, 1036, 967, 908, 869, 840, 814, 767, 708, 645, 591, 543, 503, 463, 419, 367, 313, 254, 195, 136, 82, 34, -4, -48, -98, -148, -207, -282, -354, -419, -467, -505, -554, -622, -691, -756, -809, -862, -916, -969, -1026, -1093, -1160, -1213, -1265, -1315, -1375, -1440, -1511, -1588, -1647, -1698, -1737, -1770, -1814, -1865, -1931, -2004, -2073, -2132, -2189, -2246, -2295, -2340, -2385, -2431, -2474, -2509, -2553, -2609, -2674, -2737, -2779, -2805, -2823, -2857, -2896, -2928, -2961, -3001, -3051, -3096, -3125, -3139, -3147, -3153, -3176, -3206, -3250, -3281, -3296, -3297, -3286, -3271, -3271, -3304, -3347, -3372, -3380, -3370, -3340, -3320, -3324, -3344, -3370, -3393, -3402, -3399, -3385, -3360, -3336, -3325, -3315, -3315, -3327, -3344, -3344, -3330, -3313, -3281, -3251, -3223, -3208, -3205, -3205, -3195, -3182, -3160, -3128, -3096, -3069, -3048, -3019, -3002, -2994, -2973, -2945, -2920, -2887, -2846, -2810, -2772, -2734, -2692, -2652, -2625, -2608, -2583, -2541, -2483, -2412, -2340, -2293, -2265, -2231, -2189, -2136, -2073, -2005, -1939, -1874, -1825, -1778, -1725, -1674, -1629, -1566, -1501, -1437, -1377, -1323, -1269, -1211, -1142, -1087, -1051, -1023, -989, -928, -840, -750, -679, -628, -588, -567, -544, -504, -438, -349, -256, -182, -137, -103, -70, -35, 11, 71, 143, 212, 258, 290, 326, 385, 462, 548, 634, 691, 724, 738, 758, 806, 884, 972, 1063, 1136, 1178, 1203, 1239, 1293, 1358, 1427, 1496, 1565, 1623, 1675, 1730, 1791, 1854, 1913, 1960, 2012, 2064, 2112, 2169, 2232, 2293, 2340, 2384, 2436, 2495, 2541, 2574, 2604, 2643, 2692, 2738, 2781, 2832, 2871, 2902, 2939, 2969, 2991, 3015, 3041, 3064, 3080, 3101, 3123, 3143, 3160, 3186, 3219, 3239, 3246, 3246, 3246, 3248, 3253, 3273, 3297, 3306, 3303, 3308, 3315, 3320, 3325, 3332, 3334, 3323, 3309, 3299, 3290, 3286, 3290, 3290, 3277, 3270, 3274, 3280, 3275, 3252, 3221, 3197, 3184, 3181, 3187, 3192, 3180, 3141, 3108, 3085, 3067, 3054, 3043, 3030, 3024, 3010, 2971, 2915, 2869, 2842, 2832, 2829, 2811, 2771, 2717, 2657, 2606, 2565, 2541, 2526, 2514, 2479, 2421, 2344, 2267, 2215, 2192, 2170, 2127, 2063, 1987, 1912, 1856, 1814, 1779, 1742, 1693, 1628, 1565, 1507, 1456, 1399, 1331, 1266, 1219, 1179, 1138, 1097, 1061, 1013, 950, 870, 795, 743, 712, 696, 683, 651, 584, 505, 420, 342, 287, 268, 265, 239, 172, 84, -8, -74, -108, -125, -136, -174, -249, -339, -440, -532, -590, -622, -647, -678, -729, -797, -882, -973, -1048, -1095, -1127, -1157, -1204, -1271, -1361, -1445, -1509, -1562, -1611, -1652, -1692, -1746, -1807, -1878, -1956, -2017, -2057, -2094, -2128, -2162, -2214, -2280, -2342, -2401, -2462, -2516, -2563, -2597, -2628, -2674, -2728, -2786, -2837, -2862, -2879, -2901, -2938, -2984, -3026, -3053, -3075, -3097, -3115, -3142, -3177, -3209, -3233, -3254, -3270, -3277, -3275, -3267, -3265, -3293, -3336, -3364, -3371, -3363, -3354, -3346, -3339, -3336, -3337, -3355, -3386, -3407, -3401, -3364, -3319, -3291, -3291, -3305, -3330, -3360, -3373, -3359, -3321, -3277, -3239, -3213, -3199, -3196, -3206, -3220, -3214, -3182, -3137, -3091, -3053, -3032, -3014, -3001, -2992, -2984, -2969, -2947, -2920, -2880, -2828, -2779, -2746, -2726, -2708, -2684, -2644, -2598, -2551, -2498, -2450, -2416, -2387, -2361, -2330, -2268, -2173, -2084, -2021, -1986, -1964, -1938, -1912, -1862, -1775, -1676, -1585, -1510, -1466, -1443, -1419, -1380, -1313, -1223, -1137, -1072, -1030, -1001, -962, -899, -836, -779, -718, -657, -598, -546, -493, -435, -387, -347, -299, -239, -184, -124, -59, 8, 67, 111, 150, 184, 225, 278, 343, 412, 481, 550, 623, 686, 728, 750, 767, 801, 866, 960, 1063, 1142, 1181, 1200, 1234, 1287, 1353, 1426, 1494, 1547, 1596, 1657, 1722, 1780, 1829, 1881, 1943, 2007, 2050, 2089, 2138, 2192, 2261, 2338, 2404, 2455, 2497, 2538, 2585, 2634, 2683, 2739, 2786, 2821, 2843, 2869, 2899, 2927, 2968, 3013, 3046, 3074, 3094, 3122, 3155, 3176, 3183, 3187, 3183, 3190, 3217, 3260, 3293, 3307, 3311, 3302, 3282, 3272, 3287, 3315, 3337, 3347, 3339, 3325, 3315, 3320, 3338, 3346, 3334, 3314, 3301, 3293, 3281, 3276, 3286, 3298, 3291, 3270, 3259, 3245, 3232, 3222, 3209, 3179, 3154, 3134, 3127, 3132, 3127, 3113, 3085, 3046, 3010, 2979, 2955, 2936, 2911, 2897, 2883, 2856, 2819, 2784, 2759, 2728, 2692, 2646, 2591, 2540, 2507, 2480, 2451, 2416, 2366, 2305, 2228, 2152, 2096, 2071, 2051, 2011, 1954, 1892, 1827, 1757, 1690, 1627, 1579, 1548, 1512, 1459, 1395, 1328, 1267, 1217, 1155, 1094, 1050, 1014, 981, 949, 916, 860, 789, 718, 660, 616, 580, 546, 508, 454, 392, 336, 291, 253, 209, 154, 90, 21, -43, -101, -146, -175, -213, -269, -349, -437, -507, -555, -600, -651, -705, -760, -824, -895, -952, -995, -1040, -1099, -1175, -1253, -1315, -1361, -1395, -1439, -1508, -1592, -1659, -1714, -1762, -1805, -1846, -1895, -1943, -2002, -2082, -2169, -2228, -2256, -2283, -2328, -2387, -2459, -2516, -2565, -2612, -2650, -2688, -2732, -2769, -2817, -2872, -2913, -2943, -2957, -2981, -3016, -3050, -3090, -3140, -3181, -3196, -3198, -3203, -3214, -3240, -3268, -3278, -3281, -3293, -3301, -3303, -3306, -3300, -3311, -3329, -3350, -3361, -3368, -3370, -3361, -3351, -3339, -3328, -3331, -3342, -3360, -3367, -3356, -3327, -3291, -3259, -3262, -3295, -3331, -3341, -3312, -3259, -3199, -3164, -3169, -3194, -3215, -3208, -3187, -3148, -3099, -3050, -3009, -2974, -2965, -2987, -3016, -3011, -2955, -2868, -2794, -2756, -2748, -2750, -2749, -2726, -2675, -2603, -2538, -2495, -2479, -2459, -2403, -2328, -2248, -2184, -2143, -2118, -2102, -2072, -2014, -1929, -1825, -1728, -1663, -1639, -1637, -1606, -1540, -1469, -1395, -1337, -1295, -1242, -1176, -1099, -1024, -961, -913, -870, -834, -789, -741, -700, -643, -576, -500, -431, -378, -342, -317, -286, -231, -157, -72, 6, 51, 87, 133, 187, 240, 289, 335, 379, 422, 483, 556, 636, 700, 749, 787, 825, 875, 946, 1025, 1094, 1140, 1173, 1212, 1268, 1336, 1411, 1488, 1552, 1603, 1645, 1685, 1738, 1801, 1866, 1932, 1996, 2052, 2091, 2124, 2164, 2219, 2283, 2349, 2410, 2460, 2507, 2543, 2580, 2624, 2681, 2737, 2786, 2821, 2839, 2861, 2890, 2928, 2973, 3020, 3059, 3079, 3083, 3089, 3108, 3138, 3168, 3202, 3236, 3261, 3275, 3271, 3260, 3248, 3254, 3267, 3276, 3292, 3316, 3341, 3360, 3355, 3334, 3313, 3311, 3321, 3335, 3342, 3331, 3309, 3286, 3279, 3285, 3286, 3283, 3279, 3269, 3258, 3240, 3218, 3205, 3201, 3195, 3190, 3176, 3149, 3108, 3075, 3050, 3036, 3034, 3031, 3024, 3014, 2991, 2942, 2888, 2852, 2830, 2823, 2814, 2784, 2728, 2655, 2603, 2583, 2580, 2560, 2513, 2450, 2377, 2314, 2280, 2262, 2246, 2209, 2142, 2062, 1983, 1918, 1869, 1829, 1785, 1742, 1694, 1631, 1558, 1487, 1424, 1380, 1344, 1299, 1250, 1198, 1141, 1080, 1022, 975, 935, 898, 843, 775, 719, 676, 638, 602, 565, 511, 452, 396, 343, 299, 254, 199, 137, 86, 32, -24, -73, -120, -165, -228, -290, -348, -417, -491, -549, -598, -652, -711, -767, -825, -886, -945, -1000, -1060, -1133, -1198, -1249, -1298, -1352, -1398, -1443, -1506, -1581, -1652, -1715, -1772, -1820, -1862, -1910, -1967, -2028, -2093, -2161, -2223, -2281, -2330, -2367, -2415, -2471, -2524, -2569, -2611, -2650, -2687, -2733, -2786, -2839, -2879, -2910, -2947, -2987, -3024, -3050, -3073, -3091, -3113, -3148, -3179, -3206, -3229, -3250, -3259, -3272, -3287, -3297, -3307, -3315, -3317, -3321, -3340, -3365, -3386, -3389, -3383, -3371, -3356, -3349, -3349, -3347, -3361, -3389, -3409, -3415, -3398, -3367, -3333, -3297, -3274, -3284, -3326, -3355, -3364, -3347, -3301, -3244, -3197, -3178, -3182, -3187, -3185, -3176, -3160, -3145, -3122, -3108, -3093, -3060, -3009, -2953, -2912, -2892, -2903, -2920, -2908, -2851, -2778, -2723, -2687, -2659, -2628, -2589, -2540, -2493, -2436, -2377, -2334, -2306, -2274, -2225, -2160, -2093, -2019, -1952, -1894, -1851, -1823, -1789, -1719, -1632, -1550, -1482, -1435, -1405, -1364, -1304, -1231, -1167, -1108, -1059, -1011, -958, -902, -835, -757, -685, -639, -611, -591, -558, -514, -450, -369, -280, -196, -138, -102, -84, -63, -23, 36, 112, 195, 268, 321, 361, 404, 442, 487, 555, 624, 684, 735, 788, 844, 897, 953, 1014, 1068, 1116, 1168, 1213, 1261, 1319, 1397, 1481, 1551, 1608, 1662, 1702, 1723, 1751, 1793, 1863, 1953, 2045, 2111, 2152, 2170, 2191, 2237, 2305, 2383, 2458, 2521, 2561, 2579, 2600, 2635, 2681, 2732, 2790, 2840, 2873, 2900, 2922, 2952, 2994, 3044, 3084, 3108, 3117, 3128, 3149, 3169, 3175, 3185, 3203, 3230, 3258, 3276, 3284, 3288, 3284, 3278, 3285, 3301, 3322, 3329, 3329, 3324, 3318, 3315, 3313, 3310, 3319, 3327, 3317, 3288, 3266, 3261, 3261, 3255, 3257, 3263, 3252, 3239, 3230, 3219, 3192, 3151, 3118, 3104, 3106, 3116, 3123, 3111, 3078, 3029, 2986, 2948, 2919, 2910, 2919, 2927, 2910, 2863, 2796, 2728, 2683, 2658, 2644, 2635, 2625, 2595, 2538, 2467, 2407, 2361, 2330, 2299, 2264, 2220, 2166, 2114, 2060, 1996, 1922, 1846, 1792, 1753, 1722, 1686, 1649, 1605, 1548, 1475, 1388, 1304, 1244, 1201, 1173, 1156, 1137, 1083, 1008, 924, 845, 786, 760, 760, 739, 686, 612, 530, 462, 412, 362, 318, 293, 267, 214, 144, 79, 24, -24, -84, -149, -205, -249, -289, -339, -399, -473, -546, -615, -664, -698, -735, -782, -856, -947, -1036, -1098, -1138, -1170, -1207, -1260, -1332, -1416, -1495, -1561, -1607, -1650, -1699, -1747, -1804, -1868, -1933, -1994, -2044, -2095, -2152, -2207, -2268, -2325, -2389, -2456, -2502, -2544, -2593, -2635, -2677, -2720, -2765, -2815, -2860, -2907, -2947, -2982, -3008, -3025, -3041, -3066, -3099, -3140, -3177, -3191, -3198, -3207, -3217, -3235, -3262, -3291, -3308, -3311, -3305, -3308, -3312, -3324, -3337, -3350, -3371, -3389, -3393, -3382, -3360, -3333, -3328, -3353, -3386, -3402, -3386, -3357, -3336, -3320, -3309, -3315, -3329, -3336, -3318, -3288, -3273, -3263, -3247, -3229, -3204, -3191, -3181, -3171, -3165, -3150, -3117, -3075, -3044, -3026, -3018, -3011, -2997, -2962, -2921, -2878, -2839, -2796, -2766, -2742, -2729, -2722, -2698, -2656, -2590, -2520, -2449, -2397, -2365, -2349, -2331, -2295, -2230, -2135, -2043, -1970, -1920, -1886, -1859, -1831, -1777, -1709, -1635, -1554, -1476, -1413, -1365, -1325, -1270, -1201, -1136, -1080, -1031, -987, -948, -901, -837, -767, -697, -624, -561, -525, -504, -483, -437, -358, -282, -223, -176, -138, -105, -54, 18, 102, 170, 218, 245, 265, 307, 372, 444, 512, 581, 645, 694, 736, 778, 817, 862, 924, 997, 1073, 1142, 1199, 1240, 1274, 1320, 1369, 1432, 1512, 1586, 1643, 1700, 1746, 1789, 1836, 1888, 1952, 2022, 2087, 2133, 2177, 2216, 2255, 2309, 2375, 2437, 2489, 2533, 2577, 2619, 2663, 2714, 2762, 2803, 2839, 2861, 2874, 2895, 2927, 2971, 3028, 3093, 3134, 3153, 3152, 3146, 3140, 3150, 3180, 3208, 3244, 3268, 3276, 3276, 3277, 3285, 3297, 3303, 3305, 3310, 3314, 3314, 3306, 3295, 3299, 3305, 3315, 3329, 3330, 3319, 3299, 3270, 3243, 3236, 3246, 3263, 3268, 3256, 3246, 3233, 3208, 3180, 3154, 3136, 3131, 3130, 3125, 3106, 3087, 3077, 3060, 3029, 2997, 2976, 2951, 2912, 2857, 2821, 2814, 2817, 2808, 2782, 2731, 2670, 2616, 2568, 2538, 2519, 2490, 2442, 2383, 2328, 2285, 2249, 2214, 2167, 2109, 2040, 1977, 1925, 1881, 1846, 1814, 1764, 1690, 1610, 1537, 1487, 1468, 1449, 1406, 1343, 1262, 1178, 1109, 1062, 1031, 1005, 983, 955, 908, 839, 761, 680, 617, 587, 566, 532, 484, 430, 370, 318, 265, 209, 150, 93, 38, -17, -61, -103, -153, -213, -292, -373, -433, -469, -507, -558, -626, -706, -776, -836, -891, -929, -965, -1019, -1091, -1176, -1258, -1327, -1371, -1395, -1426, -1487, -1566, -1647, -1727, -1789, -1820, -1832, -1878, -1953, -2034, -2110, -2175, -2227, -2282, -2333, -2376, -2410, -2449, -2494, -2548, -2609, -2663, -2713, -2761, -2809, -2855, -2894, -2930, -2957, -2979, -2995, -3026, -3073, -3113, -3145, -3169, -3190, -3207, -3231, -3264, -3284, -3284, -3287, -3291, -3289, -3295, -3324, -3347, -3366, -3375, -3379, -3379, -3374, -3368, -3366, -3371, -3376, -3371, -3363, -3359, -3358, -3360, -3366, -3366, -3353, -3329, -3301, -3293, -3295, -3303, -3307, -3295, -3261, -3222, -3197, -3188, -3196, -3199, -3192, -3169, -3126, -3082, -3048, -3036, -3045, -3053, -3033, -2987, -2930, -2879, -2830, -2794, -2780, -2782, -2780, -2758, -2711, -2649, -2599, -2566, -2527, -2476, -2426, -2375, -2321, -2267, -2221, -2187, -2148, -2089, -2006, -1929, -1881, -1843, -1805, -1747, -1681, -1615, -1542, -1475, -1428, -1393, -1358, -1315, -1246, -1150, -1061, -995, -955, -933, -906, -857, -793, -708, -630, -579, -557, -529, -480, -416, -329, -244, -186, -154, -133, -106, -65, -6, 61, 128, 210, 283, 336, 375, 415, 469, 511, 551, 612, 667, 715, 774, 841, 908, 972, 1029, 1077, 1119, 1160, 1207, 1261, 1323, 1392, 1470, 1542, 1595, 1634, 1673, 1712, 1756, 1824, 1894, 1956, 2010, 2057, 2102, 2153, 2215, 2277, 2338, 2398, 2445, 2465, 2481, 2518, 2590, 2673, 2749, 2796, 2824, 2833, 2839, 2863, 2898, 2944, 2992, 3030, 3071, 3108, 3130, 3137, 3135, 3147, 3170, 3195, 3217, 3239, 3257, 3266, 3276, 3282, 3280, 3282, 3286, 3299, 3313, 3326, 3340, 3337, 3324, 3315, 3305, 3298, 3290, 3290, 3299, 3298, 3292, 3281, 3275, 3270, 3260, 3252, 3248, 3238, 3214, 3192, 3173, 3168, 3171, 3166, 3145, 3109, 3072, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

def find_top_frequencies(buffer):
    # Perform FFT
    fft_result = rfft(buffer)
    fft_magnitude = np.abs(fft_result)
    
    # Find frequencies
    freqs = rfftfreq(len(buffer), 1 / SAMPLING_FREQUENCY)
    
    # Get top 3 frequencies
    top_indices = np.argsort(fft_magnitude)[-3:]
    top_frequencies = freqs[top_indices]
    top_magnitudes = fft_magnitude[top_indices]
    return top_frequencies, top_magnitudes  # Return both frequencies and magnitudes

def main():
    start_time = time.time()  # Record the start time
    while True:
        # Use the PCM_Buffer directly
        buffer_data = PCM_Buffer

        # Find top 3 frequencies and their magnitudes
        top_frequencies, top_magnitudes = find_top_frequencies(buffer_data)
        
        # Print the top frequencies and their magnitudes
        for freq, mag in zip(top_frequencies, top_magnitudes):
            print(f"Frequency: {freq} Hz, Magnitude: {mag}")

        # Check if 1kHz is among the top frequencies
        if any(abs(freq - DETECTION_FREQUENCY) <= FREQUENCY_TOLERANCE for freq in top_frequencies):
            print("1kHz found")
            break  # Stop if 1kHz is found

        # Check for timeout
        if time.time() - start_time >= TIMEOUT_SECONDS:
            print("Timeout reached. Target frequency not found.")
            break

main()
